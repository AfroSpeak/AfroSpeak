let voices = [];
window.speechSynthesis.onvoiceschanged = function() {
    voices = speechSynthesis.getVoices();
    console.log(voices); // This will display available voices in the console
};

async function generateDialogue() {
    const apiKey = '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';  // Add your Hugging Face API token here
    const endpoint = 'https://api-inference.huggingface.co/models/EleutherAI/gpt-neo-2.7B'; // Using GPT-Neo

    const headers = {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
    };

    const body = {
        inputs: conversation + '\nAfro-pessimist:',
        parameters: { max_new_tokens: 100, temperature: 0.85 }
    };

    try {
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(body)
        });

        const data = await response.json();
        const newDialogue = data[0]?.generated_text || "Error: No dialogue generated";

        // Append the new part of the conversation
        conversation += '\n' + newDialogue;
        document.getElementById('conversation').innerText = conversation;

        // Use Web Speech API to read out the conversation
        const lines = newDialogue.split("\n");

        lines.forEach(line => {
            let utterance = new SpeechSynthesisUtterance(line);
            // Make sure voices are loaded before assigning them
            if (voices.length > 0) {
                if (line.includes("Afro-pessimist")) {
                    utterance.voice = voices.find(voice => voice.name === "Google UK English Male");
                } else if (line.includes("Afrofuturist")) {
                    utterance.voice = voices.find(voice => voice.name === "Google UK English Female");
                }
                speechSynthesis.speak(utterance);
            } else {
                console.error('Voices not loaded yet');
            }
        });

    } catch (error) {
        console.error('Error generating text:', error);
        document.getElementById('conversation').innerText = "An error occurred. Please try again.";
    }
}
